
<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>อัปโหลดลายผ้าเข้าเว็บ</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            font-family: 'Noto Serif Thai', serif;
            background-color: #fef9f6;
            color: #600020;
            padding: 2rem;
            text-align: center;
        }
        input[type="text"], input[type="file"], button {
            padding: 10px;
            margin: 10px;
            width: 300px;
        }
    </style>
</head>
<body>
    <h2>อัปโหลดลายผ้าเข้าเว็บ</h2>
    <input type="file" id="fileInput" multiple><br>
    <input type="text" id="collectionName" placeholder="พิมพ์ชื่อคอลเลคชั่น"><br>
    <progress id="progressBar" value="0" max="100" style="width: 300px;"></progress><br>
    <button onclick="uploadImages()">อัปโหลดภาพ</button>

    <!-- Important: Load config before any script that uses Supabase -->
    <script src="config.js"></script>
    <script>
        async function uploadImages() {
            const files = document.getElementById("fileInput").files;
            const collection = document.getElementById("collectionName").value.trim();
            const bar = document.getElementById("progressBar");

            if (!collection) {
                alert("กรุณากรอกชื่อคอลเลคชั่นก่อน");
                return;
            }

            if (!files.length) {
                alert("กรุณาเลือกภาพ");
                return;
            }

            let count = 0;
            for (const file of files) {
                const { data, error } = await supabase.storage
                    .from("fabrics")
                    .upload(`${collection}/${collection}-${String(count + 1).padStart(2, '0')}.jpg`, file);

                count++;
                bar.value = (count / files.length) * 100;

                if (error) {
                    alert("อัปโหลดบางภาพล้มเหลว");
                    console.error(error);
                }
            }

            alert("อัปโหลดสำเร็จ");
            location.reload();
        }
    </script>
</body>
</html>
