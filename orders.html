<script type="module">
  import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'

  const SUPABASE_URL = 'https://zhiflvlhamuijgxgeadr.supabase.co'
  const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpoaWZsdmxoYW11aWpneGdlYWRyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDYzNzUzNzIsImV4cCI6MjA2MTk1MTM3Mn0.ls2H6MOei5bDe07jTyiquGSQj-euw8rJH4643W2zKBk'

  const supabase = createClient(SUPABASE_URL, SUPABASE_KEY)

  async function loadOrders() {
    const { data, error } = await supabase
      .from('orders')
      .select('*')
      .order('created_at', { ascending: false })

    if (error) {
      console.error('โหลดข้อมูลผิดพลาด:', error)
      return
    }

    const tbody = document.getElementById('orderBody')
    tbody.innerHTML = ''

    data.forEach(order => {
      const tr = document.createElement('tr')
      tr.innerHTML = `
        <td>${new Date(order.created_at).toLocaleDateString('th-TH')}</td>
        <td>${order.customer || '-'}</td>
        <td>${order.amount != null ? (+order.amount).toLocaleString() : '-'}</td>
        <td class="status ${order.status === 'มัดจำแล้ว' ? 'green' : order.status === 'พร้อมส่ง' ? 'yellow' : 'red'}">
            ${order.status || '-'}
        </td>
        <td>
          ${order.slip_url ? `<a href="${order.slip_url}" target="_blank">ดูสลิป</a>` : '-'}
        </td>
        <td class="actions">
          <button onclick="alert('แก้ไข ${order.customer}')">แก้ไข</button>
          <button onclick="alert('พิมพ์บิล ${order.customer}')">พิมพ์</button>
        </td>
      `
      tbody.appendChild(tr)
    })
  }

  loadOrders()
</script>
