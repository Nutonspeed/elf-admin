
<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡πÄ‡∏õ‡∏¥‡∏î‡∏ö‡∏¥‡∏• | ELF</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <style>
    body { font-family: 'Noto Serif Thai', serif; padding: 2rem; background: #fff8f8; }
    label, input, textarea { display: block; margin-bottom: 0.5rem; width: 100%; max-width: 600px; }
    button { background: #800020; color: white; padding: 0.7rem 1rem; border: none; border-radius: 6px; margin-top: 1rem; cursor: pointer; }
    #linkBox { margin-top: 2rem; background: #f6e6e6; padding: 1rem; border-radius: 10px; display: none; }
    #linkBox input { width: 100%; }
  </style>
</head>
<body>
  <h1>‡πÄ‡∏õ‡∏¥‡∏î‡∏ö‡∏¥‡∏•‡πÉ‡∏´‡∏°‡πà</h1>
  <label>‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ <input id="name" required></label>
  <label>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£ <input id="phone"></label>
  <label>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà <textarea id="address" rows="3"></textarea></label>
  <label>‡∏¢‡∏≠‡∏î‡πÄ‡∏ï‡πá‡∏° <input id="total" type="number"></label>
  <label>‡∏°‡∏±‡∏î‡∏à‡∏≥ <input id="deposit" type="number"></label>
  <label>‡∏ß‡∏±‡∏ô‡∏à‡∏±‡∏î‡∏™‡πà‡∏á <input id="delivery_date" type="date"></label>
  <label>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏•‡∏≤‡∏¢‡∏ú‡πâ‡∏≤ <input id="image" type="file" accept="image/*"></label>
  <button onclick="submitBill()">üì¶ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏¥‡∏•</button>

  <div id="linkBox">
    <p>üîó ‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ö‡∏¥‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤:</p>
    <input id="billLink" readonly>
    <button onclick="copyLink()">üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå</button>
    <a id="viewBtn" target="_blank"><button>üëÅ‚Äçüó® ‡πÄ‡∏õ‡∏¥‡∏î‡∏î‡∏π‡∏ö‡∏¥‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</button></a>
  </div>

  <script>
    const supabase = supabase.createClient(
      'https://zhiflvlhamuijgxgeadr.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpoaWZsdmxoYW11aWpneGdlYWRyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDYzNzUzNzIsImV4cCI6MjA2MTk1MTM3Mn0.ls2H6MOei5bDe07jTyiquGSQj-euw8rJH4643W2zKBk'
    );

    let imageBase64 = "";

    document.getElementById('image').addEventListener('change', (e) => {
      const reader = new FileReader();
      reader.onload = () => { imageBase64 = reader.result; }
      reader.readAsDataURL(e.target.files[0]);
    });

    async function submitBill() {
      const name = document.getElementById('name').value;
      const phone = document.getElementById('phone').value;
      const address = document.getElementById('address').value;
      const total = +document.getElementById('total').value;
      const deposit = +document.getElementById('deposit').value;
      const remain = total - deposit;
      const date = document.getElementById('delivery_date').value;

      const { count } = await supabase.from('orders').select('*', { count: 'exact', head: true });
      const order_number = `ORD-${(count + 1).toString().padStart(5, '0')}`;

      const { error } = await supabase.from('orders').insert([{
        name, phone, address, total, deposit, remain, delivery_date: date, image: imageBase64, status: '‡∏£‡∏≠‡∏°‡∏±‡∏î‡∏à‡∏≥', order_number
      }]);

      if (!error) {
        const link = `https://elf-admin.vercel.app/bill.html?id=${order_number}`;
        document.getElementById('billLink').value = link;
        document.getElementById('viewBtn').href = link;
        document.getElementById('linkBox').style.display = 'block';
      } else {
        alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ö‡∏¥‡∏•');
      }
    }

    function copyLink() {
      const linkInput = document.getElementById('billLink');
      linkInput.select();
      document.execCommand('copy');
      alert('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÅ‡∏•‡πâ‡∏ß!');
    }
  </script>
</body>
</html>
